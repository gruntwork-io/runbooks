---
title: <GitHubAuth>
---

import { Aside } from '@astrojs/starlight/components';

The `<GitHubAuth>` block provides a streamlined interface for authenticating to GitHub. It automatically detects existing authentication from environment variables or GitHub CLI, and provides OAuth or PAT authentication as fallback. Once authenticated, credentials are automatically available to subsequent [Command](/authoring/blocks/command/) and [Check](/authoring/blocks/check/) blocks.

## Basic Usage

```mdx
<GitHubAuth
  id="gh-auth"
  title="Authenticate to GitHub"
  description="Sign in to access private repositories"
/>
```

By default, Runbooks will automatically detect and use credentials from:
1. Environment variables (`GITHUB_TOKEN` or `GH_TOKEN`)
2. GitHub CLI (`gh auth token`)

If no credentials are detected, users can authenticate manually via OAuth or PAT.

## Authentication Methods

The GitHubAuth block supports multiple authentication sources:

| Method | Description | 
|--------|-------------|
| **Environment Variable** | Auto-detected from `GITHUB_TOKEN` or `GH_TOKEN` |
| **GitHub CLI** | Auto-detected from `gh auth token` |
| **OAuth** | Sign in via GitHub's device authorization flow (recommended) |
| **Personal Access Token** | Enter a PAT (classic or fine-grained) directly | 

## Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `id` | string | required | Unique identifier for this component |
| `title` | string | "GitHub Authentication" | Display title shown in the UI |
| `description` | string | - | Description of the authentication purpose |
| `detectCredentials` | `false` or `CredentialSource[]` | `['env', 'cli']` | Credential detection configuration |
| `oauthClientId` | string | Gruntwork default | Custom OAuth App client ID |
| `oauthScopes` | string[] | `["repo"]` | OAuth scopes to request |

## Environment Variables

When authentication succeeds, the following environment variables are automatically set for subsequent Command and Check blocks:

| Variable | Description |
|----------|-------------|
| `GITHUB_TOKEN` | The GitHub access token |
| `GITHUB_USER` | The authenticated user's login name |

These variables are set in the session environment, so all subsequent blocks have access without needing to explicitly reference `githubAuthId`.

## Using with Commands and Checks

When you authenticate to GitHub using the GitHubAuth block, the [environment variables above](#environment-variables) are automatically made available to all subsequent Command and Check blocks. This means that Command and Check blocks will use the most recently authenticated GitHubAuth block (if any) to get GitHub authentication credentials.

Any subsequent GitHub authentication will update the environment variables and then become the default GitHub authentication credentials.

However, in some cases, you may want to use a specific GitHub authentication with a block, not just the most recent GitHub authentication. To do that, you can reference a specific GitHubAuth block from Command or Check blocks using the `githubAuthId` prop. For example:

```mdx
<GitHubAuth
  id="gh-auth"
  title="Authenticate to GitHub"
/>

<Check
  id="verify-auth"
  title="Verify GitHub Access"
  command="gh auth status"
  githubAuthId="gh-auth"
  successMessage="Successfully authenticated!"
/>

<Command
  id="clone-repo"
  title="Clone Repository"
  command="git clone https://github.com/org/repo.git"
  githubAuthId="gh-auth"
  successMessage="Repository cloned!"
/>
```

<Aside type="tip">
While you can use `githubAuthId` to explicitly reference the GitHubAuth block, the credentials are also set as session environment variables. This means subsequent blocks will have GitHub access even without `githubAuthId`, though using it makes the dependency explicit.
</Aside>

## OAuth Scopes

The default scope is `["repo"]` which provides full repository access (read/write to public and private repos). Common scope combinations:

| Scope | Description |
|-------|-------------|
| `repo` | Full access to private and public repositories |
| `public_repo` | Access to public repositories only |
| `repo:status` | Read/write commit status (useful for CI) |
| `read:org` | Read organization membership |

For a complete list, see [GitHub's OAuth scopes documentation](https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/scopes-for-oauth-apps).

```mdx
<GitHubAuth
  id="gh-auth"
  title="Limited GitHub Access"
  oauthScopes={["public_repo", "read:org"]}
/>
```

## GitHub Enterprise

**GitHub Enterprise Cloud** (hosted by GitHub at github.com): OAuth works normally. Enterprise Cloud organizations use the same github.com domain.

**GitHub Enterprise Server** (self-hosted at your own URL like github.yourcompany.com): OAuth is not supported for security reasons. Use PAT authentication or contact Gruntwork for enterprise support options.

## Credential Detection

By default, GitHubAuth automatically detects existing credentials from environment variables and GitHub CLI. You can customize this behavior with the `detectCredentials` prop.

### Default Behavior

With no configuration, GitHubAuth tries these sources in order:

```mdx
{/* Default - same as detectCredentials={['env', 'cli']} */}
<GitHubAuth id="gh-auth" />
```

1. **Environment variables** - `GITHUB_TOKEN` or `GH_TOKEN`
2. **GitHub CLI** - `gh auth token`

If either source provides valid credentials, authentication succeeds immediately. If neither is found, users see the manual OAuth/PAT interface.

### Detection Sources

| Source | Description |
|--------|-------------|
| `'env'` | Check standard env vars (`GITHUB_TOKEN`, `GH_TOKEN`) |
| `'cli'` | Check GitHub CLI (`gh auth token`) |
| `{ env: 'VAR_NAME' }` | Check a specific env var |
| `{ block: 'block-id' }` | Use token from a Command block's output |

### Custom Detection Order

Check only environment variables:

```mdx
<GitHubAuth
  id="gh-auth"
  detectCredentials={['env']}
/>
```

Check a specific env var first, then standard locations:

```mdx
<GitHubAuth
  id="gh-auth"
  detectCredentials={[{ env: 'MY_GITHUB_TOKEN' }, 'env', 'cli']}
/>
```

### Disable Auto-Detection

Force manual authentication only:

```mdx
<GitHubAuth
  id="gh-auth"
  detectCredentials={false}
/>
```

### From Command Output

Use a token generated by a previous Command block:

```mdx
<Command
  id="fetch-token"
  path="scripts/get-token.sh"
  title="Fetch GitHub Token"
/>

<GitHubAuth
  id="dynamic-auth"
  title="GitHub Access"
  detectCredentials={[{ block: 'fetch-token' }]}
/>
```

The Command script should output the token:

```bash
#!/bin/bash
# Example: fetch token from a secrets manager
TOKEN=$(vault read -field=token secret/github)
echo "GITHUB_TOKEN=$TOKEN" >> "$RUNBOOK_OUTPUT"
```

### Scope Validation

When detecting credentials from GitHub CLI, Runbooks also checks the token's scopes. If the `repo` scope is missing, a warning is displayed since some operations (private repos, issues, PRs) may fail.

## Security

### How OAuth Authentication Works

When you authenticate via OAuth, GitHubAuth uses the [Device Authorization Grant](https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/authorizing-oauth-apps#device-flow):

1. Runbooks (on your machine) requests a device code from GitHub
2. You open github.com/login/device and enter the code
3. You see "Gruntwork Runbooks wants to access your account" and approve
4. Your local Runbooks instance receives the token directly from GitHub

Importantly, your token never passes through any Gruntwork server. It goes directly from GitHub to your local machine.

### Attack Vector Analysis

#### 1. Malicious Runbook with Custom `oauthClientId`

**Scenario**: A malicious runbook author publishes a runbook with `oauthClientId="attacker-app-id"`.

**What happens**:
- You see "Attacker's App" (not "Gruntwork Runbooks") on GitHub's authorization page
- If you approve, the token still goes to YOUR local machine, not the attacker
- The attacker registered an OAuth app but has no server receiving tokens

**Risk**: Low. The attacker cannot intercept your token.

**Impact**: Minimal. You authorized a differently-named app, but the attacker has no way to access your token.

**Mitigation**: Runbooks shows a warning when `oauthClientId` differs from the default. Always verify the app name on GitHub's authorization page matches what you expect.

#### 2. Malicious Runbook with Custom Base URL

**Risk**: None - this attack is blocked.

We do NOT allow `oauthBaseUrl` as a runbook prop. GitHubAuth only communicates with github.com. This prevents phishing attacks where a malicious runbook could redirect OAuth to a fake GitHub login page.

#### 3. Scope Escalation via Runbook

**Scenario**: A runbook author sets `oauthScopes={["repo", "admin:org", "delete_repo"]}` requesting excessive permissions.

**What happens**: GitHub's authorization page shows all requested scopes. If you approve without reading carefully, you grant broader access than needed.

**Risk**: Medium. Depends on user vigilance.

**Mitigation**: Always review the scope list on GitHub's authorization page before approving. Default is `["repo"]` which is sufficient for most operations. Be suspicious of runbooks requesting `admin:*`, `delete_repo`, or `write:*` scopes.

### Security Best Practices

1. **Review the authorization page** - Verify it says "Gruntwork Runbooks" and shows expected scopes
2. **Check runbook source** - Before running unfamiliar runbooks, review the GitHubAuth props
3. **Use OAuth over PAT** - OAuth tokens can be scoped and are easier to revoke
4. **Revoke unused authorizations** - Manage at github.com/settings/applications

### Verifying Your Authorization

After authenticating, you can verify and manage the authorization at:
- https://github.com/settings/applications - See authorized OAuth apps
- https://github.com/settings/tokens - See active tokens (for PAT auth)

You can revoke access at any time from these pages.

## Example: Clone and Work with Repository

~~~mdx
<GitHubAuth id="gh-auth" />

<Inputs id="repo-config">
```yaml
repo_url:
  name: Repository URL
  type: string
  description: HTTPS URL of the repository to clone
  default: https://github.com/gruntwork-io/runbooks.git
```
</Inputs>

<Command
  id="clone-repo"
  githubAuthId="gh-auth"
  inputsId="repo-config"
  title="Clone Repository"
  command="git clone {{ .repo_url }}"
/>
~~~
