# Test configuration for demo-runbook-outputs
# Generated by: runbooks test init
# Edit this file to customize your tests.

version: 1

settings:
  # Generate files to a temp directory (cleaned up after test)
  use_temp_output: true
  # Test timeout
  timeout: 5m
  # Can this runbook's tests run in parallel with others?
  parallelizable: true

tests:
  - name: happy-path
    description: Standard successful execution

    inputs:
      # config_name: string, required
      account-config.config_name:
        fuzz:
          type: string
          minLength: 5
          maxLength: 20
      # description: string
      account-config.description:
        fuzz:
          type: string
          minLength: 5
          maxLength: 20
      # environment: enum [dev, staging, prod]
      tagging-inputs.environment:
        fuzz:
          type: enum
          options: [dev, staging, prod]
      # owner: string, required
      tagging-inputs.owner:
        fuzz:
          type: string
          minLength: 5
          maxLength: 20
      # team_name: enum [engineering, product]
      team-filter.team_name:
        fuzz:
          type: enum
          options: [engineering, product]

    # steps:
    #   # Note: Order matters! Blocks that produce outputs must run before
    #   # blocks that consume them via {{ ._blocks.x.outputs.y }}

    #   # First: Commands that produce outputs
    #   - block: create-account
    #     expect: success

    #   - block: create-resources
    #     expect: success

    #   - block: tag-resources
    #     expect: success

    #   - block: list-users
    #     expect: success

    #   # Then: TemplateInline blocks that depend on those outputs
    #   - block: template-account-summary
    #     # Renders: account-summary.txt
    #     # Depends on: create_account.account_id, create_account.region
    #     expect: success

    #   - block: template-resource-tags
    #     # Renders: resource-tags.json
    #     # Uses inputs from: tagging-inputs
    #     # Depends on: create_account.account_id, create_account.region
    #     expect: success

    #   - block: template-users
    #     # Renders: users.txt
    #     # Depends on: list_users.users
    #     expect: success

    #   - block: template-teams
    #     # Renders: teams.yaml
    #     # Depends on: list_users.teams
    #     expect: success

    #   - block: template-team-report
    #     # Renders: team-report.md
    #     # Uses inputs from: team-filter
    #     expect: success

    #   # Finally: verify-setup depends on create-account and create-resources outputs
    #   - block: verify-setup
    #     expect: success

    assertions:
      # TemplateInline blocks automatically validate their output dependencies.
      # Add additional assertions to validate test results:
      # - type: file_exists
      #   path: generated/README.md
      # - type: file_contains
      #   path: generated/README.md
      #   contains: "expected content"
      # - type: files_generated
      #   block: account-config
      #   min_count: 1

    # cleanup:
    #   - command: rm -rf /tmp/test-resources
    #   - path: cleanup/teardown.sh
