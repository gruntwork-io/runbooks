# Test configuration for lambda feature demo
# Generated by: runbooks test init
# Edit this file to customize your tests.

version: 1

settings:
  # Generate files to a temp directory (cleaned up after test)
  use_temp_output: true
  # Test timeout
  timeout: 5m
  # Can this runbook's tests run in parallel with others?
  parallelizable: true

tests:
  - name: happy-path
    description: Standard successful execution

    inputs:
      # Environment: enum [non-prod, prod]
      lambda-config.Environment:
        fuzz:
          type: enum
          options: ["non-prod", "prod"]
      # AwsRegion: enum [us-east-1, us-east-2, us-west-1, us-west-2, eu-central-1, eu-west-1, eu-west-2], required
      lambda-config.AwsRegion:
        fuzz:
          type: enum
          options: ["us-east-1", "us-east-2", "us-west-1", "us-west-2", "eu-central-1", "eu-west-1", "eu-west-2"]
      # FunctionName: string, required
      lambda-config.FunctionName:
        fuzz:
          type: string
          minLength: 5
          maxLength: 20
      # Description: string
      lambda-config.Description:
        fuzz:
          type: string
          minLength: 5
          maxLength: 20
      # Runtime: enum [python3.13, python3.12, python3.11, nodejs24.x, nodejs22.x, nodejs20.x, nodejs18.x], required
      lambda-config.Runtime:
        fuzz:
          type: enum
          options: ["python3.13", "python3.12", "python3.11", "nodejs24.x", "nodejs22.x", "nodejs20.x", "nodejs18.x"]
      # Handler: string
      lambda-config.Handler:
        fuzz:
          type: string
          minLength: 5
          maxLength: 20
      # LogLevel: enum [, DEBUG, INFO, WARNING, ERROR]
      lambda-config.LogLevel:
        fuzz:
          type: enum
          options: ["", "DEBUG", "INFO", "WARNING", "ERROR"]
      # MemorySize: int, required
      lambda-config.MemorySize:
        fuzz:
          type: int
          min: 1
          max: 100
      # Timeout: int, required
      lambda-config.Timeout:
        fuzz:
          type: int
          min: 1
          max: 100
      # ReservedConcurrency: int
      lambda-config.ReservedConcurrency:
        fuzz:
          type: int
          min: 1
          max: 100
      # GithubOrgName: string, required
      repo-config.GithubOrgName:
        fuzz:
          type: string
          minLength: 5
          maxLength: 20
      # GithubRepoName: string, required
      repo-config.GithubRepoName:
        fuzz:
          type: string
          minLength: 5
          maxLength: 20

    steps:
      # Test tool installation and template generation
      - block: check-mise
        expect: success

      - block: install-tools
        expect: success

      - block: lambda-config
        expect: success

      # Skip blocks that require external services (GitHub, AWS)
      # These will be tested separately with dedicated testing strategies:
      # - create-pr: requires GitHub repo
      # - terragrunt-plan/apply: requires AWS credentials
      # - test-function: requires deployed Lambda

    assertions:
      # Validate template generated expected files
      - type: file_exists
        path: generated/terragrunt.hcl
      - type: file_exists
        path: generated/src/app.py
      # Test files are automatically cleaned up (written to temp directory)
