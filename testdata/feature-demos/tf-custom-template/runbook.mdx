# TfModule Custom Template Demo

This runbook demonstrates the `<TfModule>` component, which parses an OpenTofu module
at runtime and lets authors generate output files using `<Template>` or `<TemplateInline>`.

## Configure Lambda Module

The form below is dynamically generated by parsing the `.tf` files in the lambda-function test module.
Change any value and watch the template previews update automatically after submitting.

<TfModule id="lambda-vars" source="../../test-fixtures/tofu-modules/lambda-function" />

## Generate with Template (Recommended)

The `<Template>` block points to the `templates/lambda-deploy` directory, which contains a
`boilerplate.yml`, a `terragrunt.hcl` template, and a `config.yaml` template. It imports all
TfModule values via `inputsId` and renders its own form for extra variables (`environment` and
`team_owner`) defined in `boilerplate.yml`.

<Template id="lambda-deploy" path="templates/lambda-deploy" inputsId="lambda-vars" />

## Generate with TemplateInline

For quick, single-file output you can embed the template directly in the runbook. This is
handy for prototyping but doesn't scale to multiple files or extra variables the way
`<Template>` does.

### Terragrunt HCL (using hcl_inputs iteration)

This template iterates over all module variables dynamically using `_module.hcl_inputs`,
which pre-formats each value as an HCL literal (strings quoted, bools/numbers raw).

<TemplateInline inputsId="lambda-vars" outputPath="terragrunt.hcl" generateFile={true}>
```hcl
terraform {
  source = "{{ ._module.source }}"
}

include "root" {
  path   = find_in_parent_folders("root.hcl")
  expose = true
}

inputs = {
{{- range $name, $hcl := ._module.hcl_inputs }}
  {{ $name }} = {{ $hcl }}
{{- end }}
}
```
</TemplateInline>

### Non-Empty Inputs

This template uses `_module.hcl_inputs_non_empty`, which only includes variables whose
current value differs from the module's declared default. Required variables are always
included. With the lambda module defaults, `handler` and `description` are omitted when unchanged.

<TemplateInline inputsId="lambda-vars" outputPath="terragrunt-minimal.hcl" generateFile={true}>
```hcl
terraform {
  source = "{{ ._module.source }}"
}

include "root" {
  path   = find_in_parent_folders("root.hcl")
  expose = true
}

inputs = {
{{- range $name, $hcl := ._module.hcl_inputs_non_empty }}
  {{ $name }} = {{ $hcl }}
{{- end }}
}
```
</TemplateInline>

### Individual Variable Access

You can also access specific variables by name (not just through iteration).
For example, referencing `function_name` directly:

<TemplateInline inputsId="lambda-vars" outputPath="function-info.txt">
```
Function Name: {{ .function_name }}
Runtime: {{ .runtime }}
Source: {{ ._module.source }}
```
</TemplateInline>
