# TfModule Custom Template Demo

This runbook demonstrates the `<TfModule>` component, which parses an OpenTofu module
at runtime and lets authors write custom output templates using `<TemplateInline>`.

## Configure S3 Bucket Module

The form below is dynamically generated by parsing the `.tf` files in the s3-bucket test module.
Change any value and watch the template preview update automatically after submitting.

<TfModule id="s3-vars" path="../../test-fixtures/tofu-modules/lambda-function" source="github.com/example/modules//s3-bucket?ref=v1.0.0" />

## Preview: Terragrunt HCL (using hcl_inputs iteration)

This template iterates over all module variables dynamically using `_module.hcl_inputs`,
which pre-formats each value as an HCL literal (strings quoted, bools/numbers raw, maps as JSON).

<TemplateInline inputsId="s3-vars" outputPath="terragrunt.hcl" generateFile={true}>
```hcl
terraform {
  source = "{{ ._module.source }}"
}

include "root" {
  path   = find_in_parent_folders("root.hcl")
  expose = true
}

inputs = {
{{- range $name, $hcl := ._module.hcl_inputs }}
  {{ $name }} = {{ $hcl }}
{{- end }}
}
```
</TemplateInline>

## Preview: YAML Config (custom format)

The same module variables rendered as a completely different format â€” a YAML config file.
This demonstrates that authors can produce **any** output format they want.

<TemplateInline inputsId="s3-vars" outputPath="config.yaml">
```yaml
module:
  source: "{{ ._module.source }}"
  path: "{{ ._module.path }}"

variables:
{{- range $name, $val := ._module.inputs }}
  {{ $name }}: {{ $val }}
{{- end }}
```
</TemplateInline>

## Preview: Individual Variable Access

You can also access specific variables by name (not just through iteration).
For example, referencing `bucket_name` directly:

<TemplateInline inputsId="s3-vars" outputPath="bucket-info.txt">
```
Bucket Name: {{ .bucket_name }}
Versioning: {{ .versioning_enabled }}
Source: {{ ._module.source }}
```
</TemplateInline>
