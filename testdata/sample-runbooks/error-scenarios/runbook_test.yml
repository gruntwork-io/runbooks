# Test configuration for error-scenarios
# Generated by: runbooks test init
# Edit this file to customize your tests.

version: 1

settings:
  # Generate files to a temp directory (cleaned up after test)
  use_temp_output: true
  # Test timeout
  timeout: 5m
  # Can this runbook's tests run in parallel with others?
  parallelizable: true

tests:
  - name: happy-path
    description: Standard successful execution

    inputs:
      # complex_var: custom_unsupported_type
      unsupported-type.complex_var:
        fuzz:
          type: string
          minLength: 5
          maxLength: 20
      # var1: string
      duplicate-inputs-id.var1:
        fuzz:
          type: string
          minLength: 5
          maxLength: 20
      # greeting: string
      working-inputs.greeting:
        fuzz:
          type: string
          minLength: 5
          maxLength: 20
      # name: string
      working-inputs.name:
        fuzz:
          type: string
          minLength: 5
          maxLength: 20

    steps:
      # Note: Order matters! Blocks that produce outputs must run before
      # blocks that consume them via {{ ._blocks.x.outputs.y }}
      # If no blocks are listed, the test runs all blocks in document order.

      - block: cmd-missing-file
        expect: config_error
        error_contains: "Script file not found"

      - block: cmd-with-redirect
        expect: success

      - block: cmd-missing-vars
        expect: skip

      - block: cmd-exec-fail
        expect: fail

      - block: duplicate-cmd-id
        expect: success

      - block: check-missing-file
        expect: config_error
        error_contains: "Script file not found"

      - block: check-missing-title
        expect: success

      - block: check-warning
        expect: warn

      - block: check-failure
        expect: fail

      - block: duplicate-check-id
        expect: success

      - block: template-missing-path
        expect: config_error
        error_contains: "path"

      - block: template-nonexistent
        expect: config_error
        error_contains: "template directory not found"

      - block: duplicate-template-id
        expect: config_error  # First one fails because templates/test doesn't exist

      - block: working-cmd
        expect: success

      - block: working-check
        expect: success

      - block: working-cmd-with-inputs
        expect: success

    assertions:
      # TemplateInline blocks automatically validate their output dependencies.
      # Add additional assertions to validate test results:
      # - type: file_exists
      #   path: generated/README.md
      # - type: file_contains
      #   path: generated/README.md
      #   contains: "expected content"
      # - type: files_generated
      #   block: template-missing-path
      #   min_count: 1

    # cleanup:
    #   - command: rm -rf /tmp/test-resources
    #   - path: cleanup/teardown.sh
